<!doctype html><html><head><title>Basic Redis Examples with Go</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link rel=stylesheet href=/css/flag-icon.min.css><link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/images/author/dan_hu9475e40123017607cf3e014e405fbc8c_9664_42x0_resize_q75_box.jpg><meta property="og:title" content="Basic Redis Examples with Go"><meta property="og:description" content="Basic Redis Examples with Go"><meta property="og:type" content="article"><meta property="og:url" content="https://gilcrest.github.io/posts/archive/basic-redis-examples/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-07-17T20:38:00-04:00"><meta property="article:modified_time" content="2018-07-17T20:38:00-04:00"><meta name=description content="Basic Redis Examples with Go"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css><link rel=stylesheet href=/css/style.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/><img src=/images/author/dan_hu9475e40123017607cf3e014e405fbc8c_9664_42x0_resize_q75_box.jpg alt=Logo>
Dan Gillis</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"></ul></div></div><img src=/images/author/dan_hu9475e40123017607cf3e014e405fbc8c_9664_42x0_resize_q75_box.jpg class=d-none id=main-logo alt=Logo>
<img src=/images/author/dan_hu9475e40123017607cf3e014e405fbc8c_9664_42x0_resize_q75_box.jpg class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><a href=/posts/errors/ title="REST API Error Handling in Go">REST API Error Handling in Go</a></li><li><a href=/posts/conversion/ title="Jekyll to Hugo Conversion">Jekyll to Hugo Conversion</a></li><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/archive/>Archive</a><ul class=active><li><a href=/posts/archive/http-logging-and-go-api-template-updates/ title="HTTP Logging and Go API Template Updates">HTTP Logging and Go API Template Updates</a></li><li><a class=active href=/posts/archive/basic-redis-examples/ title="Basic Redis Examples with Go">Basic Redis Examples with Go</a></li><li><a href=/posts/archive/containerize-go-api/ title="Containerizing a Go API with Docker For Mac">Containerizing a Go API with Docker For Mac</a></li><li><a href=/posts/archive/http-json-error-responses/ title="HTTP JSON Error Responses in Go">HTTP JSON Error Responses in Go</a></li><li><a href=/posts/archive/king-crimson-red/ title="Drums - King Crimson Red Live @ Great Scott">Drums - King Crimson Red Live @ Great Scott</a></li><li><a href=/posts/archive/go-api-template/ title="Go API Template v0.0.2">Go API Template v0.0.2</a></li><li><a href=/posts/archive/go/ title=Go>Go</a></li><li><a href=/posts/archive/frankenstein/ title="Drums - Frankenstein Practice">Drums - Frankenstein Practice</a></li><li><a href=/posts/archive/osx-oracle-node-setup/ title="OS X Oracle + Node setup">OS X Oracle + Node setup</a></li><li><a href=/posts/archive/drums-raju-live/ title="Drums - Raju Live">Drums - Raju Live</a></li><li><a href=/posts/archive/apex-minimize/ title="Apex 5 - Minimize Left Sidebar">Apex 5 - Minimize Left Sidebar</a></li><li><a href=/posts/archive/raiser/ title=Raiser>Raiser</a></li><li><i class="fas fa-plus-circle"></i><a href=/posts/archive/node-oracle-glory/>Node Oracle Glory</a><ul><li><a href=/posts/archive/node-oracle-glory/volume-3/ title="Volume 3">Volume 3</a></li><li><a href=/posts/archive/node-oracle-glory/volume-2/ title="Volume 2">Volume 2</a></li><li><a href=/posts/archive/node-oracle-glory/volume-1/ title="Volume 1">Volume 1</a></li></ul></li><li><a href=/posts/archive/name-value-encryption/ title="Name:Value Encryption Utility using PL/SQL">Name:Value Encryption Utility using PL/SQL</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(https://gilcrest.github.io/images/default-hero.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/dan_hu9475e40123017607cf3e014e405fbc8c_9664_120x120_fit_q75_box.jpg alt="Author Image"><h5 class=author-name>Dan Gillis</h5><p>July 17, 2018</p></div><div class=title><h1>Basic Redis Examples with Go</h1></div><div class=post-content id=post-content><p>Redis is pretty great. It is the #1 most loved database for the second year in a row, <a href=https://insights.stackoverflow.com/survey/2018/#technology-most-loved-dreaded-and-wanted-databases>according to a recent Stack Overflow survey</a>. I decided it was high time I taught myself how to use it with Go.</p><p>There are a number of libraries in the Go ecosystem for Redis, but the two most popular are <a href=https://github.com/go-redis/redis>go-redis</a> and <a href=https://github.com/gomodule/redigo>redigo</a>. Each library has a decent amount of stars, contributors, etc. but from what I can tell redigo seems to have a slight edge in terms of documentation and community acceptance. For instance, the mighty Redis Labs, has a couple of posts describing interacting with Redis via Go using <em>redigo</em> — it’s not a direct endorsement, but pretty close… I tried both libraries actually, but found redigo was better documented. That said, in order to get up and running quickly with redigo, having to troll through godoc was a bit cumbersome (I’m still getting my head around analyzing godoc TBH). In this post, I’ll attempt to give some simple examples for <em>redigo</em> that may prove helpful to some.</p><p>Below I take you through creating a connection pool, testing connectivity via the <code>PING</code> command, adding a simple Key:Value pair via the <code>SET</code> command, retrieving a given value given the <code>GET</code> command and finally storing a struct as JSON using the <code>SET</code> command and retrieving the same struct with the <code>GET</code> command.</p><p>TL;DR — For the full main.go with all the examples below, you can find them <a href=https://github.com/gilcrest/redigo-example/blob/master/main.go>here</a>.</p><h2 id=pool>POOL</h2><p>To establish connectivity in redigo, you need to create a <code>redis.Pool</code> object which is a pool of connections to Redis. In order to do this, you can use something like the following:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>newPool</span>() <span style=color:#f92672>*</span><span style=color:#a6e22e>redis</span>.<span style=color:#a6e22e>Pool</span> {
    <span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>redis</span>.<span style=color:#a6e22e>Pool</span>{
        <span style=color:#75715e>// Maximum number of idle connections in the pool.
</span><span style=color:#75715e></span>        <span style=color:#a6e22e>MaxIdle</span>: <span style=color:#ae81ff>80</span>,
        <span style=color:#75715e>// max number of connections
</span><span style=color:#75715e></span>        <span style=color:#a6e22e>MaxActive</span>: <span style=color:#ae81ff>12000</span>,
        <span style=color:#75715e>// Dial is an application supplied function for creating and
</span><span style=color:#75715e></span>        <span style=color:#75715e>// configuring a connection.
</span><span style=color:#75715e></span>        <span style=color:#a6e22e>Dial</span>: <span style=color:#66d9ef>func</span>() (<span style=color:#a6e22e>redis</span>.<span style=color:#a6e22e>Conn</span>, <span style=color:#66d9ef>error</span>) {
            <span style=color:#a6e22e>c</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>redis</span>.<span style=color:#a6e22e>Dial</span>(<span style=color:#e6db74>&#34;tcp&#34;</span>, <span style=color:#e6db74>&#34;:6379&#34;</span>)
            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
                panic(<span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>())
            }
            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>, <span style=color:#a6e22e>err</span>
        },
    }
}
</code></pre></div><p>Use the Get method of the Pool object to grab a connection from the pool. Per the redigo documentation, “The application must call the connection Close method when the application is done with the connection.”</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
    <span style=color:#a6e22e>pool</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>newPool</span>()
    <span style=color:#a6e22e>conn</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>pool</span>.<span style=color:#a6e22e>Get</span>()
    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>conn</span>.<span style=color:#a6e22e>Close</span>()
    <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ping</span>(<span style=color:#a6e22e>conn</span>)
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>err</span>)
    }
<span style=color:#f92672>...</span>
</code></pre></div><h2 id=ping>PING</h2><p>If you wish you to simply check connectivity, you can use Redis’ <code>PING</code> command.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#75715e>// ping tests connectivity for redis (PONG should be returned)
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>ping</span>(<span style=color:#a6e22e>c</span> <span style=color:#a6e22e>redis</span>.<span style=color:#a6e22e>Conn</span>) <span style=color:#66d9ef>error</span> {
    <span style=color:#75715e>// Send PING command to Redis
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>pong</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Do</span>(<span style=color:#e6db74>&#34;PING&#34;</span>)
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
    }

    <span style=color:#75715e>// PING command returns a Redis &#34;Simple String&#34;
</span><span style=color:#75715e></span>    <span style=color:#75715e>// Use redis.String to convert the interface type to string
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>redis</span>.<span style=color:#a6e22e>String</span>(<span style=color:#a6e22e>pong</span>, <span style=color:#a6e22e>err</span>)
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
    }

    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;PING Response = %s\n&#34;</span>, <span style=color:#a6e22e>s</span>)
    <span style=color:#75715e>// Output: PONG
</span><span style=color:#75715e></span>
    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
}
</code></pre></div><p>To break down what’s happening here — the function takes in a redis Conn type (connection). We are calling the Do method of Conn, which takes a Redis command as it’s first argument. The redigo client communicates to Redis using Redis’ <a href=https://redis.io/topics/protocol#resp-protocol-description>RESP</a> protocol. Redis then responds with one of several types (Simple Strings, Errors, Integers, Bulk Strings and Arrays), which are mapped to Go types. The response from the Do method does not give back the specific Go type though, but rather an interface{} type. We can use a type assertion to determine the response type from the Do method, but seeing as we know from the <a href=https://redis.io/commands/ping#return-value>Redis documentation</a> that the Return Value from PING is a simple string, we can use one of redigo’s handy helper functions (<code>redis.String</code>) to perform a type conversion to string for us.</p><p>For illustrative purposes in my example above, I executed the helper <code>redis.String</code> function separately from the <code>Do</code> method as I found it easier to understand on my first pass. In reality, you’ll use the redigo provided helper functions to wrap your <code>Do</code> method calls (provided you know the response type), as I have done in the example below. Any remaining examples will use this shortened form where appropriate.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#75715e>// ping tests connectivity for redis (PONG should be returned)
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>ping</span>(<span style=color:#a6e22e>c</span> <span style=color:#a6e22e>redis</span>.<span style=color:#a6e22e>Conn</span>) <span style=color:#66d9ef>error</span> {
    <span style=color:#75715e>// Send PING command to Redis
</span><span style=color:#75715e></span>    <span style=color:#75715e>// PING command returns a Redis &#34;Simple String&#34;
</span><span style=color:#75715e></span>    <span style=color:#75715e>// Use redis.String to convert the interface type to string
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>redis</span>.<span style=color:#a6e22e>String</span>(<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Do</span>(<span style=color:#e6db74>&#34;PING&#34;</span>))
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
    }

    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;PING Response = %s\n&#34;</span>, <span style=color:#a6e22e>s</span>)
    <span style=color:#75715e>// Output: PONG
</span><span style=color:#75715e></span>
    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
}
</code></pre></div><h2 id=set>SET</h2><p>Use the Redis <code>SET</code> command to add a key:value pair to Redis. Below is a trivial example of adding a key (“Favorite Movie”) and a string value for it (“Repo Man”) as well as an int value (1984 as the movie Release Year). The blank identifier is used for the reply as we only need to check for errors (“OK” is the only thing that comes back on a successful <code>SET</code> command reply).</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#75715e>// set executes the redis SET command
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>set</span>(<span style=color:#a6e22e>c</span> <span style=color:#a6e22e>redis</span>.<span style=color:#a6e22e>Conn</span>) <span style=color:#66d9ef>error</span> {
    <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Do</span>(<span style=color:#e6db74>&#34;SET&#34;</span>, <span style=color:#e6db74>&#34;Favorite Movie&#34;</span>, <span style=color:#e6db74>&#34;Repo Man&#34;</span>)
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
    }
    <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Do</span>(<span style=color:#e6db74>&#34;SET&#34;</span>, <span style=color:#e6db74>&#34;Release Year&#34;</span>, <span style=color:#ae81ff>1984</span>)
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
    }    
    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
}
</code></pre></div><h2 id=get>GET</h2><p>In order to retrieve a value for a given key, use the Redis <code>GET</code> command. Some simple examples are below, including an example where no results are retrieved. We can check for <code>redis.ErrNil</code> to determine if nothing is returned and should handle appropriately.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#75715e>// get executes the redis GET command
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>c</span> <span style=color:#a6e22e>redis</span>.<span style=color:#a6e22e>Conn</span>) <span style=color:#66d9ef>error</span> {

    <span style=color:#75715e>// Simple GET example with String helper
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>key</span> <span style=color:#f92672>:=</span> <span style=color:#e6db74>&#34;Favorite Movie&#34;</span>
    <span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>redis</span>.<span style=color:#a6e22e>String</span>(<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Do</span>(<span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#a6e22e>key</span>))
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#66d9ef>return</span> (<span style=color:#a6e22e>err</span>)
    }
    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%s = %s\n&#34;</span>, <span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>s</span>)

    <span style=color:#75715e>// Simple GET example with Int helper
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>key</span> = <span style=color:#e6db74>&#34;Release Year&#34;</span>
    <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>redis</span>.<span style=color:#a6e22e>Int</span>(<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Do</span>(<span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#a6e22e>key</span>))
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#66d9ef>return</span> (<span style=color:#a6e22e>err</span>)
    }
    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%s = %d\n&#34;</span>, <span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>i</span>)

    <span style=color:#75715e>// Example where GET returns no results
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>key</span> = <span style=color:#e6db74>&#34;Nonexistent Key&#34;</span>
    <span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>redis</span>.<span style=color:#a6e22e>String</span>(<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Do</span>(<span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#a6e22e>key</span>))
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>redis</span>.<span style=color:#a6e22e>ErrNil</span> {
        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%s does not exist\n&#34;</span>, <span style=color:#a6e22e>key</span>)
    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
    } <span style=color:#66d9ef>else</span> {
        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%s = %s\n&#34;</span>, <span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>s</span>)
    }

    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
}
</code></pre></div><h2 id=struct-set>STRUCT (SET)</h2><p>For my purposes of building a look-aside cache, I want to store objects in cache in their entirety in Redis. There seem to be a few different viewpoints on doing this — one where you store your object using a Redis Hash data type and the <code>HMSET</code> command. This is nice because, if need be you can update individual values within the object independently. I have seen examples of people using the redigo <code>AddFlat</code> method of the <code>redigo.Args</code> type to accomplish this, but also noted in redigo’s <a href=https://github.com/gomodule/redigo/wiki/FAQ#does-redigo-provide-a-way-to-serialize-structs-to-redis>FAQ</a> that redigo does not actually provide a way to serialize structs to Redis, so I stayed away from trying this.</p><p>For my purposes, I am ok with just storing the data as an object in its entirety and thus decided to store my data as JSON using the <code>SET</code> command.</p><p>The example below shows storing a user, with username “otto”, with a key of “user:otto”. Use <code>json.Marshal</code> to serialize your object to JSON and store the serialized version as the value.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>setStruct</span>(<span style=color:#a6e22e>c</span> <span style=color:#a6e22e>redis</span>.<span style=color:#a6e22e>Conn</span>) <span style=color:#66d9ef>error</span> {

    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>objectPrefix</span> <span style=color:#66d9ef>string</span> = <span style=color:#e6db74>&#34;user:&#34;</span>

    <span style=color:#a6e22e>usr</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>User</span>{
        <span style=color:#a6e22e>Username</span>:  <span style=color:#e6db74>&#34;otto&#34;</span>,
        <span style=color:#a6e22e>MobileID</span>:  <span style=color:#ae81ff>1234567890</span>,
        <span style=color:#a6e22e>Email</span>:     <span style=color:#e6db74>&#34;ottoM@repoman.com&#34;</span>,
        <span style=color:#a6e22e>FirstName</span>: <span style=color:#e6db74>&#34;Otto&#34;</span>,
        <span style=color:#a6e22e>LastName</span>:  <span style=color:#e6db74>&#34;Maddox&#34;</span>,
    }

    <span style=color:#75715e>// serialize User object to JSON
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>json</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Marshal</span>(<span style=color:#a6e22e>usr</span>)
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
    }

    <span style=color:#75715e>// SET object
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Do</span>(<span style=color:#e6db74>&#34;SET&#34;</span>, <span style=color:#a6e22e>objectPrefix</span><span style=color:#f92672>+</span><span style=color:#a6e22e>usr</span>.<span style=color:#a6e22e>Username</span>, <span style=color:#a6e22e>json</span>)
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
    }

    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
}
</code></pre></div><h2 id=struct-get>STRUCT (GET)</h2><p>The example below shows retrieving the object using the <code>GET</code> command and then deserializing it with <code>json.Unmarshal</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getStruct</span>(<span style=color:#a6e22e>c</span> <span style=color:#a6e22e>redis</span>.<span style=color:#a6e22e>Conn</span>) <span style=color:#66d9ef>error</span> {

    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>objectPrefix</span> <span style=color:#66d9ef>string</span> = <span style=color:#e6db74>&#34;user:&#34;</span>

    <span style=color:#a6e22e>username</span> <span style=color:#f92672>:=</span> <span style=color:#e6db74>&#34;otto&#34;</span>
    <span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>redis</span>.<span style=color:#a6e22e>String</span>(<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Do</span>(<span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#a6e22e>objectPrefix</span><span style=color:#f92672>+</span><span style=color:#a6e22e>username</span>))
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>redis</span>.<span style=color:#a6e22e>ErrNil</span> {
        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;User does not exist&#34;</span>)
    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
    }

    <span style=color:#a6e22e>usr</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>User</span>{}
    <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>([]byte(<span style=color:#a6e22e>s</span>), <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>usr</span>)

    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%+v\n&#34;</span>, <span style=color:#a6e22e>usr</span>)

    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>

}
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{<span style=color:#960050;background-color:#1e0010>Username:otto</span> <span style=color:#960050;background-color:#1e0010>MobileID:1234567890</span> <span style=color:#960050;background-color:#1e0010>Email:ottoM@repoman.com</span> <span style=color:#960050;background-color:#1e0010>FirstName:Otto</span> <span style=color:#960050;background-color:#1e0010>LastName:Maddox</span>}
</code></pre></div><hr><p>That’s it for now. Keep in mind, I wrote this main and these little functions in a somewhat non-idiomatic way just to aid in the examples, you should streamline this in a real app.</p><p>I also created a similar <code>main.go</code> for the go-redis client, that you can find <a href=https://github.com/gilcrest/go-redis-example/blob/master/main.go>here</a>. For <code>go-redis</code>, storing structs as Redis hashes is easier, as you can pass a map of strings type to the <code>HMSET</code> command.</p></div><div class=btn-improve-page><a href=https://github.com/gilcrest/gilcrest.github.io/edit/source/content/posts/archive/basic-redis-examples/index.md title="Improve this page" target=_blank rel=noopener><i class="fas fa-code-branch"></i>
Improve this page</a></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/archive/http-logging-and-go-api-template-updates/ title="HTTP Logging and Go API Template Updates" class="btn btn-outline-info"><div><i class="fas fa-chevron-circle-left"></i> Prev</div><div class=next-prev-text>HTTP Logging and Go API Template Updates</div></a></div><div class="col-md-6 next-article"><a href=/posts/archive/containerize-go-api/ title="Containerizing a Go API with Docker For Mac" class="btn btn-outline-info"><div>Next <i class="fas fa-chevron-circle-right"></i></div><div class=next-prev-text>Containerizing a Go API with Docker For Mac</div></a></div></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section></section></div><footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=/#about>About</a></li><li class=nav-item><a class=smooth-scroll href=/#recent-posts>Recent Posts</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><span>Email:</span> <span>dan@dangillis.dev</span></li></ul></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hossainemruz/toha target=_blank rel=noopener><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_2.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2021 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script type=text/javascript src=/js/jquery-3.4.1.min.js></script><script type=text/javascript src=/js/popper.min.js></script><script type=text/javascript src=/js/bootstrap.min.js></script><script type=text/javascript src=/js/navbar.js></script><script type=text/javascript src=/js/plyr.js></script><script type=text/javascript src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/js/single.js></script><script>hljs.initHighlightingOnLoad()</script></body></html>